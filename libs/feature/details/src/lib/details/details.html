@if (currentRow(); as data) {
  <div class="details-page">

    <div class="header-section">

      <div class="header-row-1">
        <div class="header-left">

          <button routerLink="/operations" class="back-btn">
            <img src="http://localhost:3845/assets/813cddbc7fdd9f5dbae833b466bcf79a4c1abc26.svg"
              alt="Back"
              width="32"
              height="32"
              onerror="this.style.display='none'">
          </button>

          <div class="title-section">
            <span class="alert-id">{{ data.id }}</span>
            <div class="badge status-badge">Open - L1</div>
            <div class="badge risk-badge" [ngClass]="{'risk-high': data.riskRating === 'High', 'risk-medium': data.riskRating === 'Medium', 'risk-low': data.riskRating === 'Low'}">
              {{ data.riskRating }}
            </div>
          </div>
        </div>
        <div class="header-right">

          <button (click)="isGuideOpen = true" class="text-btn">
            <img src="http://localhost:3845/assets/8a0875cd6874069a640456380fa7bc41030b9ab8.svg"
              alt="Quick Guide"
              width="24"
              height="24"
              onerror="this.style.display='none'">
            <span>Quick Guide</span>
          </button>

          <button (click)="go(gridStore.prevId())" [disabled]="!gridStore.prevId()" class="text-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Previous</span>
          </button>
          <button (click)="go(gridStore.nextId())" [disabled]="!gridStore.nextId()" class="text-btn next-btn">
            <span>Next</span>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="header-row-2">

        <div class="date-info-wrapper">

          <div class="date-info-section">
            <div class="date-item">
              <span class="date-text">Alert On: {{ formatDate(data.generatedOn) }}</span>
              <img src="http://localhost:3845/assets/7b11a1a8576cf96124d1ed4f7f9591cb81f8d942.svg"
                alt=""
                width="14"
                height="16"
                onerror="this.style.display='none'">
            </div>
            <div class="date-item">
              <span class="date-text">Ageing: {{ data.daysLapsed }}</span>
              <img src="http://localhost:3845/assets/7b11a1a8576cf96124d1ed4f7f9591cb81f8d942.svg"
                alt=""
                width="14"
                height="16"
                onerror="this.style.display='none'">
            </div>
          </div>
        </div>

        <div class="header-right-row2">
          <div class="toggle-container">
            <div class="toggle-img-wrapper" (click)="showPanel = !showPanel">

              @if (showPanel) {
                <img
                  src="http://localhost:3845/assets/741454ca6ae556cea8398ec4efa6e24616811e55.svg"
                  alt="Toggle On"
                  width="40"
                  height="20">
              }

              @if (!showPanel) {
                <img
                  src="http://localhost:3845/assets/048125fe71527407a3cf1e1230ea6592f55b072b.svg"
                  alt="Toggle Off"
                  width="40"
                  height="20">
              }
            </div>
            <span class="toggle-label">Hide Panel</span>
          </div>
        </div>
      </div>
    </div>

    <div class="models-risk-bar">
      <div class="models-row">
        <span class="section-label">Models :</span>
        <div class="tag model-tag">Attempt to Conceal Location</div>
        <div class="tag model-tag">Round Amount Activity</div>
      </div>
      <div class="risk-flags-row">
        <span class="section-label">Risk Flags :</span>
        <div class="tag risk-flag-tag">Country Sensitivity</div>
        <div class="tag risk-flag-tag">Opaque Structure</div>
      </div>
    </div>

    <div class="tab-bar-wrapper">
      <div class="tab-bar">
        <button (click)="activeTab = 'overview'"
          class="tab"
          [class.selected]="activeTab === 'overview'"
          [class.unselected]="activeTab !== 'overview'">
          Overview
        </button>
        <button (click)="activeTab = 'disambiguation'"
          class="tab"
          [class.selected]="activeTab === 'disambiguation'"
          [class.unselected]="activeTab !== 'disambiguation'">
          Disambiguation
        </button>
        <button (click)="activeTab = 'alertSummary'"
          class="tab"
          [class.selected]="activeTab === 'alertSummary'"
          [class.unselected]="activeTab !== 'alertSummary'">
          Alert Summary
        </button>
      </div>
      <div class="tab-bar-border"></div>
    </div>

    <div class="content-area">

      <div class="main-content">

        @if (activeTab === 'disambiguation') {
          <div class="disambiguation-content">

            <div class="sub-tab-bar">
              <button (click)="activeSubTab = 'mainEntity'"
                class="sub-tab"
                [class.selected]="activeSubTab === 'mainEntity'">
                Main Entity
              </button>
              <button (click)="activeSubTab = 'transactionParties'"
                class="sub-tab"
                [class.selected]="activeSubTab === 'transactionParties'">
                Transaction Parties
              </button>
              <div class="sub-tab-divider"></div>
            </div>

            <div class="entity-parent-section">
              <div class="dropdown-section">
                <label class="field-label">Main Entity Parent:</label>
                <div class="dropdown">
                  <select>
                    <option>Main Party - 1</option>
                    <option>Main Party - 2</option>
                  </select>
                  <svg class="dropdown-icon" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 4.5L6 7.5L9 4.5" stroke="#605e5c" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <span class="p2e-id">P2E_ID_SELECTEDID</span>
              </div>
              <div class="flag-section">
                <span class="flag-label">Flag Party pair quality issue.</span>

                <div class="toggle-img-wrapper" (click)="flagPartyPairIssue = !flagPartyPairIssue">
                  @if (flagPartyPairIssue) {
                    <img
                      src="http://localhost:3845/assets/741454ca6ae556cea8398ec4efa6e24616811e55.svg"
                      alt="Toggle On"
                      width="40"
                      height="20">
                  }
                  @if (!flagPartyPairIssue) {
                    <img
                      src="http://localhost:3845/assets/048125fe71527407a3cf1e1230ea6592f55b072b.svg"
                      alt="Toggle Off"
                      width="40"
                      height="20">
                  }
                </div>
              </div>
            </div>

            <div class="entity-table">
              <table>
                <thead>
                  <tr>
                    <th class="col-select">Select</th>
                    <th class="col-name">Entity Name</th>
                    <th class="col-type">Identity Type</th>
                    <th class="col-identity">Identity</th>
                  </tr>
                </thead>
                <tbody>

                  @for (entity of entities; track entity; let i = $index) {
                    <tr [class.even]="i % 2 === 0" [class.odd]="i % 2 === 1">
                      <td class="col-select">
                        <div class="radio-wrapper">
                          <input type="radio" name="entitySelect" [value]="i" [(ngModel)]="selectedEntityIndex">
                        </div>
                      </td>
                      <td class="col-name">
                        <span class="entity-name">{{ entity.name }}</span>
                      </td>
                      <td class="col-type">
                        <div class="dropdown table-dropdown">
                          <select [(ngModel)]="entity.identityType">
                            <option>LEI</option>
                            <option>FENERGO</option>
                            <option>CRDS</option>
                            <option>RMPM</option>
                            <option>New</option>
                          </select>
                          <svg class="dropdown-icon" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 4.5L6 7.5L9 4.5" stroke="#605e5c" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </div>
                      </td>
                      <td class="col-identity">

                        <input type="text"
                          [(ngModel)]="entity.identity"
                          placeholder="Type in"
                          class="text-field">
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        }

        @if (activeTab === 'overview') {
          <div class="placeholder-content">
            Overview content - Client: {{ data.clientName }}, Type: {{ data.type }}, Priority: {{ data.priority }}
          </div>
        }

        @if (activeTab === 'alertSummary') {
          <div class="placeholder-content">
            Alert Summary - Score: {{ data.score }}, Jurisdiction: {{ data.jurisdiction }}
          </div>
        }

        @if (showPanel && activeTab === 'disambiguation') {
          <div class="right-panel">
            <div class="panel-content">
              <div class="panel-icon">
                <img src="http://localhost:3845/assets/3bc9fb47a2cec4a71fa78f3f1112fee909a42552.svg"
                  alt="Disambiguation"
                  width="80"
                  height="80"
                  onerror="this.style.display='none'">
              </div>
              <h3 class="panel-title">Disambiguation!</h3>
              <p class="panel-description">
                <span class="bold">What is disambiguation? What action is expected from users?</span>
                <span class="light"> ultrices vitae facilisi sed aliquam lectus adipiscing gravida iaculis adipiscing arcu non eget laoreet at id.</span>
              </p>
            </div>
          </div>
        }
      </div>
    </div>

    <poc-guide-drawer [isOpen]="isGuideOpen" (close)="isGuideOpen = false"></poc-guide-drawer>
  </div>
}
