@if (currentRow(); as data) {
  <div class="details-page">

    <div class="header-section">

      <div class="header-row-1">
        <div class="header-left">

          <button routerLink="/operations" class="back-btn">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="16" cy="16" r="14.5" stroke="#4E2683" stroke-width="3"/>
              <path d="M22 16H10M15 10L9 16L15 22" stroke="#4E2683" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <div class="title-section">
            <span class="alert-id">{{ data.id }}</span>
            <div class="badge status-badge">Open - L1</div>
            <div class="badge risk-badge" [ngClass]="{'risk-high': data.riskRating === 'High', 'risk-medium': data.riskRating === 'Medium', 'risk-low': data.riskRating === 'Low'}">
              {{ data.riskRating }}
            </div>
          </div>
        </div>
        <div class="header-right">

          <button (click)="isGuideOpen = true" class="text-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H5.17L4 17.17V4H20V16ZM11 5H13V7H11V5ZM11 9H13V15H11V9Z" fill="#4E2683"/>
            </svg>
            <span>Quick Guide</span>
          </button>

          <button (click)="go(gridStore.prevId())" [disabled]="!gridStore.prevId()" class="text-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Previous</span>
          </button>
          <button (click)="go(gridStore.nextId())" [disabled]="!gridStore.nextId()" class="text-btn next-btn">
            <span>Next</span>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="header-row-2">

        <div class="date-info-wrapper">

          <div class="date-info-section">
            <div class="date-item">
              <span class="date-text">Alert On: {{ formatDate(data.generatedOn) }}</span>
              <svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11 5H4C3.44772 5 3 5.44772 3 6V13C3 13.5523 3.44772 14 4 14H11C11.5523 14 12 13.5523 12 13V6C12 5.44772 11.5523 5 11 5Z" stroke="#4E2683" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M10 2H2V10" stroke="#4E2683" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="date-item">
              <span class="date-text">Ageing: {{ data.daysLapsed }}</span>
              <svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11 5H4C3.44772 5 3 5.44772 3 6V13C3 13.5523 3.44772 14 4 14H11C11.5523 14 12 13.5523 12 13V6C12 5.44772 11.5523 5 11 5Z" stroke="#4E2683" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M10 2H2V10" stroke="#4E2683" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
        </div>

        <div class="header-right-row2">
          <div class="toggle-container">
            <div class="toggle-img-wrapper" (click)="showPanel = !showPanel">

              @if (showPanel) {
                <svg width="40" height="20" viewBox="0 0 40 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect width="40" height="20" rx="10" fill="#4E2683"/>
                  <circle cx="30" cy="10" r="7" fill="white"/>
                </svg>
              }

              @if (!showPanel) {
                <svg width="40" height="20" viewBox="0 0 40 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="0.5" y="0.5" width="39" height="19" rx="9.5" stroke="#8A8886"/>
                  <circle cx="10" cy="10" r="7" fill="#605E5C"/>
                </svg>
              }
            </div>
            <span class="toggle-label">Hide Panel</span>
          </div>
        </div>
      </div>
    </div>

    <div class="models-risk-bar">
      <div class="models-row">
        <span class="section-label">Models :</span>
        <div class="tag model-tag">Attempt to Conceal Location</div>
        <div class="tag model-tag">Round Amount Activity</div>
      </div>
      <div class="risk-flags-row">
        <span class="section-label">Risk Flags :</span>
        <div class="tag risk-flag-tag">Country Sensitivity</div>
        <div class="tag risk-flag-tag">Opaque Structure</div>
      </div>
    </div>

    <div class="tab-bar-wrapper">
      <div class="tab-bar">
        <button (click)="activeTab = 'overview'"
          class="tab"
          [class.selected]="activeTab === 'overview'"
          [class.unselected]="activeTab !== 'overview'">
          Overview
        </button>
        <button (click)="activeTab = 'disambiguation'"
          class="tab"
          [class.selected]="activeTab === 'disambiguation'"
          [class.unselected]="activeTab !== 'disambiguation'">
          Disambiguation
        </button>
        <button (click)="activeTab = 'alertSummary'"
          class="tab"
          [class.selected]="activeTab === 'alertSummary'"
          [class.unselected]="activeTab !== 'alertSummary'">
          Alert Summary
        </button>
      </div>
      <div class="tab-bar-border"></div>
    </div>

    <div class="content-area">

      <div class="main-content">

        @if (activeTab === 'disambiguation') {
          <div class="disambiguation-content">

            <div class="sub-tab-bar">
              <button (click)="activeSubTab = 'mainEntity'"
                class="sub-tab"
                [class.selected]="activeSubTab === 'mainEntity'">
                Main Entity
              </button>
              <button (click)="activeSubTab = 'transactionParties'"
                class="sub-tab"
                [class.selected]="activeSubTab === 'transactionParties'">
                Transaction Parties
              </button>
              <div class="sub-tab-divider"></div>
            </div>

            <div class="entity-parent-section">
              <div class="dropdown-section">
                <label class="field-label">Main Entity Parent:</label>
                <div class="dropdown">
                  <select>
                    <option>Main Party - 1</option>
                    <option>Main Party - 2</option>
                  </select>
                  <svg class="dropdown-icon" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 4.5L6 7.5L9 4.5" stroke="#605e5c" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <span class="p2e-id">P2E_ID_SELECTEDID</span>
              </div>
              <div class="flag-section">
                <span class="flag-label">Flag Party pair quality issue.</span>

                <div class="toggle-img-wrapper" (click)="flagPartyPairIssue = !flagPartyPairIssue">
                  @if (flagPartyPairIssue) {
                    <svg width="40" height="20" viewBox="0 0 40 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect width="40" height="20" rx="10" fill="#4E2683"/>
                      <circle cx="30" cy="10" r="7" fill="white"/>
                    </svg>
                  }
                  @if (!flagPartyPairIssue) {
                    <svg width="40" height="20" viewBox="0 0 40 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="0.5" y="0.5" width="39" height="19" rx="9.5" stroke="#8A8886"/>
                      <circle cx="10" cy="10" r="7" fill="#605E5C"/>
                    </svg>
                  }
                </div>
              </div>
            </div>

            <div class="entity-table">
              <table>
                <thead>
                  <tr>
                    <th class="col-select">Select</th>
                    <th class="col-name">Entity Name</th>
                    <th class="col-type">Identity Type</th>
                    <th class="col-identity">Identity</th>
                  </tr>
                </thead>
                <tbody>

                  @for (entity of entities; track entity; let i = $index) {
                    <tr [class.even]="i % 2 === 0" [class.odd]="i % 2 === 1">
                      <td class="col-select">
                        <div class="radio-wrapper">
                          <input type="radio" name="entitySelect" [value]="i" [(ngModel)]="selectedEntityIndex">
                        </div>
                      </td>
                      <td class="col-name">
                        <span class="entity-name">{{ entity.name }}</span>
                      </td>
                      <td class="col-type">
                        <div class="dropdown table-dropdown">
                          <select [(ngModel)]="entity.identityType">
                            <option>LEI</option>
                            <option>FENERGO</option>
                            <option>CRDS</option>
                            <option>RMPM</option>
                            <option>New</option>
                          </select>
                          <svg class="dropdown-icon" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 4.5L6 7.5L9 4.5" stroke="#605e5c" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </div>
                      </td>
                      <td class="col-identity">

                        <input type="text"
                          [(ngModel)]="entity.identity"
                          placeholder="Type in"
                          class="text-field">
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        }

        @if (activeTab === 'overview') {
          <div class="placeholder-content">
            Overview content - Client: {{ data.clientName }}, Type: {{ data.type }}, Priority: {{ data.priority }}
          </div>
        }

        @if (activeTab === 'alertSummary') {
          <div class="placeholder-content">
            Alert Summary - Score: {{ data.score }}, Jurisdiction: {{ data.jurisdiction }}
          </div>
        }

        @if (showPanel && activeTab === 'disambiguation') {
          <div class="right-panel">
            <div class="panel-content">
              <div class="panel-icon">
                <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="10" y="20" width="60" height="40" rx="4" stroke="#4E2683" stroke-width="4"/>
                  <path d="M22 48H58" stroke="#4E2683" stroke-width="6" stroke-linecap="butt"/>
                </svg>
              </div>
              <h3 class="panel-title">Disambiguation!</h3>
              <p class="panel-description">
                <span class="bold">What is disambiguation? What action is expected from users?</span>
                <span class="light"> ultrices vitae facilisi sed aliquam lectus adipiscing gravida iaculis adipiscing arcu non eget laoreet at id.</span>
              </p>
            </div>
          </div>
        }
      </div>
    </div>

    <poc-guide-drawer [isOpen]="isGuideOpen" (close)="isGuideOpen = false"></poc-guide-drawer>
  </div>
}
